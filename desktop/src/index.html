<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:;">
    <title>Facilitta Portaria</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <!-- Carregamento do Chart.js com fallback -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Script de debug para desenvolvimento -->
    <script src="debug-modules.js"></script>
</head>
<body id="main-body">

    <div id="login-screen" class="login-container">
        <div class="login-left">
            <h1>Bem vindo</h1>
            <p>O jeito fácil de gerenciar entregas.</p>
            <form id="login-form">
                <div class="form-group">
                    <label for="username">Nome do usuário:</label>
                    <input type="text" id="username" name="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Senha:</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                <div id="login-error-message" class="status-message status-error" style="display: none;"></div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Entrar</button>
                </div>
            </form>
        </div>
        <div class="login-right">
            <img src="./assets/logo-login.png" alt="Logo" id="login-image">
        </div>
    </div>

    <div id="app-container" class="app-container hidden">
        <!-- Barra superior do app -->
        <div id="app-topbar">
            <div id="topbar-search-bar">
                <input type="text" id="topbar-search-input" placeholder="Buscar.." autocomplete="on">
                <img src="./assets/pesquisa.svg" alt="Buscar">
            </div>
        </div>
        
        <div class="sidebar">
            <img src="./assets/logofundobranco.svg" alt="Logo" class="sidebar-logo" />
            <div class="menu">
                <button id="menu-dashboard" class="menu-item">
                    <img src="./assets/dashboard.svg" alt="Dashboard" class="menu-icon" />
                    Visão geral
                </button>
                <button id="menu-encomendas" class="menu-item">
                    <img src="./assets/encomendas.svg" alt="Encomendas" class="menu-icon" />
                    Encomendas
                </button>
                <button id="menu-modo-lote" class="menu-item">
                    <img src="./assets/layers.svg" alt="Modo Lote" class="menu-icon" />
                    Modo Lote
                </button>
                <button id="menu-moradores" class="menu-item">
                    <img src="./assets/moradores.svg" alt="Moradores" class="menu-icon" />
                    Moradores
                </button>
                <button id="menu-usuarios" class="menu-item">
                    <img src="./assets/usuario.svg" alt="Usuários" class="menu-icon" />
                    Usuários
                </button>
                <button id="menu-relatorios" class="menu-item">
                    <img src="./assets/relatorio.svg" alt="Relatórios" class="menu-icon" />
                    Relatórios
                </button>
                <button id="menu-ajustes" class="menu-item">
                    <img src="./assets/ajustes.svg" alt="Ajustes" class="menu-icon" />
                    Ajustes
                </button>
            </div>
            <div class="sidebar-footer">
                <div id="logged-user-info">Usuário: -</div>
                <button id="logout-button" class="btn-logout">
                    <img src="./assets/logout-botao.svg" alt="Logout" class="logout-icon" />
                    Sair
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Conteúdo será carregado dinamicamente pelos módulos -->
        </div>
    </div>

    <!-- Modais -->
    <div id="modal-cadastro-encomenda" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-encomenda-title">Cadastrar encomenda</h2>
            <form id="form-cadastro-encomenda">
                <input type="hidden" id="encomenda-id" name="encomendaId">
                <div class="form-group">
                    <label for="morador">Morador:</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" id="morador" name="morador" required autocomplete="off" placeholder="Digite para buscar...">
                        <span id="morador-confirm-icon" class="material-symbols-outlined" style="color: green; margin-left: 6px; display: none;">check_circle</span>
                    </div>
                    <div id="morador-suggestions" class="suggestions-list"></div>
                </div>
                <div class="form-group form-row">
                    <div class="form-subgroup">
                        <label for="quantidade">Quantidade:</label>
                        <input type="number" id="quantidade" name="quantidade" required value="1" min="1">
                    </div>
                    <div class="form-subgroup">
                        <label for="data">Data Recebimento:</label>
                        <input type="date" id="data" name="data" required>
                    </div>
                    <div class="form-subgroup">
                        <label for="hora">Hora Recebimento:</label>
                        <input type="time" id="hora" name="hora" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="porteiro">Porteiro que Recebeu:</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" id="porteiro" name="porteiro" required autocomplete="off" placeholder="Digite para buscar...">
                        <span id="porteiro-confirm-icon" class="material-symbols-outlined" style="color: green; margin-left: 6px; display: none;">check_circle</span>
                    </div>
                    <div id="porteiro-suggestions" class="suggestions-list"></div>
                </div>
                <div class="form-group">
                    <label for="observacoes">Observações:</label>
                    <textarea id="observacoes" name="observacoes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" id="btn-cancelar-encomenda-modal" class="btn-secondary">Cancelar</button>
                    <button type="submit" id="btn-salvar-encomenda" class="btn-primary">Salvar Encomenda</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-cadastro-morador" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-morador-title">Cadastrar morador</h2>
            <form id="form-cadastro-morador">
                <input type="hidden" id="morador-id" name="moradorId">
                <div class="form-group">
                    <label for="morador-nome">Nome completo:</label>
                    <input type="text" id="morador-nome" name="nome" required>
                </div>
                <div class="form-group">
                    <label for="morador-telefone">Telefone:</label>
                    <input type="tel" id="morador-telefone" name="telefone" placeholder="(Opcional)">
                </div>
                <div class="form-group form-row">
                    <div class="form-subgroup">
                        <label for="morador-rua">Rua:</label>
                        <input type="text" id="morador-rua" name="rua" required>
                    </div>
                    <div class="form-subgroup">
                        <label for="morador-numero">Número:</label>
                        <input type="text" id="morador-numero" name="numero" required>
                    </div>
                </div>
                <div class="form-group form-row">
                    <div class="form-subgroup">
                        <label for="morador-bloco">Bloco/Quadra:</label>
                        <input type="text" id="morador-bloco" name="bloco" placeholder="(Opcional)">
                    </div>
                    <div class="form-subgroup">
                        <label for="morador-apartamento">AP/LT:</label>
                        <input type="text" id="morador-apartamento" name="apartamento" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="morador-observacoes">Observações:</label>
                    <textarea id="morador-observacoes" name="observacoes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" id="btn-cancelar-morador-modal" class="btn-secondary">Cancelar</button>
                    <button type="submit" id="btn-salvar-morador" class="btn-primary">Salvar Morador</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-cadastro-usuario" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-usuario-title">Cadastrar usuário</h2>
            <form id="form-cadastro-usuario">
                <input type="hidden" id="usuario-id" name="usuarioId">
                <div class="form-group">
                    <label for="usuario-nome">Nome de usuário:</label>
                    <input type="text" id="usuario-nome" name="nomeUsuario" required>
                </div>
                <div class="form-group">
                    <label for="usuario-email">Email:</label>
                    <input type="email" id="usuario-email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="usuario-senha">Senha:</label>
                    <input type="password" id="usuario-senha" name="senha" required>
                </div>
                <div class="form-group">
                    <label for="usuario-senha-confirm">Confirmar Senha:</label>
                    <input type="password" id="usuario-senha-confirm" name="senhaConfirm" required>
                </div>
                <div id="grupo-nivel-acesso" class="form-group" style="display: none;">
                    <label for="usuario-nivel-acesso">Nível de Acesso:</label>
                    <select id="usuario-nivel-acesso" name="nivelAcesso">
                        <option value="porteiro">Porteiro</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>
                <div id="grupo-status" class="form-group" style="display: none;">
                    <label for="usuario-status">Status:</label>
                    <select id="usuario-status" name="status">
                        <option value="Ativo">Ativo</option>
                        <option value="Inativo">Inativo</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" id="btn-cancelar-usuario-modal" class="btn-secondary">Cancelar</button>
                    <button type="submit" id="btn-salvar-usuario" class="btn-primary">Salvar Usuário</button>
                </div>
            </form>
        </div>
    </div>

    <div id="modal-entrega-encomenda" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-entrega-title">Registrar entrega de encomenda</h2>
            <form id="form-entrega-encomenda">
                <input type="hidden" id="entrega-encomenda-id" name="entregaEncomendaId">
                <div class="form-group">
                    <label for="entrega-morador-info">Morador:</label>
                    <input type="text" id="entrega-morador-info" name="entregaMoradorInfo" readonly>
                </div>
                <div class="form-group">
                    <label for="entrega-porteiro">Porteiro que Entregou:</label>
                    <div style="display: flex; align-items: center;">
                        <input type="text" id="entrega-porteiro" name="entregaPorteiro" required autocomplete="off" placeholder="Digite para buscar...">
                    </div>
                    <div id="entrega-porteiro-suggestions" class="suggestions-list"></div>
                </div>
                <div class="form-group form-row">
                    <div class="form-subgroup">
                        <label for="entrega-data">Data Entrega:</label>
                        <input type="date" id="entrega-data" name="entregaData" required>
                    </div>
                    <div class="form-subgroup">
                        <label for="entrega-hora">Hora Entrega:</label>
                        <input type="time" id="entrega-hora" name="entregaHora" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="entrega-retirado-por">Retirado Por:</label>
                    <input type="text" id="entrega-retirado-por" name="entregaRetiradoPor" placeholder="Nome de quem retirou">
                </div>
                <div class="form-group">
                    <label for="entrega-observacoes">Observações:</label>
                    <textarea id="entrega-observacoes" name="entregaObservacoes" rows="3"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" id="btn-cancelar-entrega-modal" class="btn-secondary">Cancelar</button>
                    <button type="submit" id="btn-confirmar-entrega" class="btn-primary">Confirmar Entrega</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal do Modo Lote -->
    <div id="modal-modo-lote" class="modal-overlay">
        <div class="modal-content modo-lote-modal">
            <!-- Header Azul -->
            <div class="modo-lote-header">
                <div class="header-content">
                    <div class="header-left">
                        <button type="button" id="btn-voltar-passo" class="btn-back">
                            <span class="material-symbols-outlined">arrow_back</span>
                        </button>
                        <div class="header-info">
                            <h2>Modo Lote</h2>
                            <p id="header-passo-info">Passo 1 de 3</p>
                        </div>
                    </div>
                    <div class="header-right">
                        <span class="material-symbols-outlined header-icon">flash</span>
                    </div>
                </div>
            </div>

            <!-- Indicadores de Progresso -->
            <div class="progress-indicators">
                <div class="progress-step" data-step="1">
                    <div class="progress-circle active" id="progress-1">
                        <span class="material-symbols-outlined">check</span>
                    </div>
                    <span class="progress-label">Dados</span>
                </div>
                <div class="progress-connector"></div>
                <div class="progress-step" data-step="2">
                    <div class="progress-circle" id="progress-2">
                        <span class="material-symbols-outlined">ellipse</span>
                    </div>
                    <span class="progress-label">Moradores</span>
                </div>
                <div class="progress-connector"></div>
                <div class="progress-step" data-step="3">
                    <div class="progress-circle" id="progress-3">
                        <span class="material-symbols-outlined">ellipse</span>
                    </div>
                    <span class="progress-label">Resumo</span>
                </div>
            </div>

            <!-- Conteúdo dos Passos -->
            <div class="modo-lote-content">
                <!-- Passo 1: Dados Comuns -->
                <div id="passo-1" class="modo-lote-passo active">
                    <h3 class="passo-titulo">Dados em comum</h3>
                    
                    <div class="form-group">
                        <label for="lote-porteiro">Porteiro <span class="required">*</span></label>
                        <div class="input-with-icon">
                            <span class="material-symbols-outlined">search</span>
                            <input type="text" id="lote-porteiro" placeholder="Digite o nome do porteiro..." autocomplete="off">
                        </div>
                        <div id="lote-porteiro-suggestions" class="suggestions-list"></div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lote-data">Data</label>
                            <div class="input-with-icon">
                                <span class="material-symbols-outlined">calendar_today</span>
                                <input type="date" id="lote-data" required>
                            </div>
                            <small class="helper-text">Ex: 25/12/2024</small>
                        </div>
                        <div class="form-group">
                            <label for="lote-hora">Hora</label>
                            <div class="input-with-icon">
                                <span class="material-symbols-outlined">schedule</span>
                                <input type="time" id="lote-hora" required>
                            </div>
                            <small class="helper-text">Ex: 14:30</small>
                        </div>
                    </div>
                </div>

                <!-- Passo 2: Seleção de Moradores -->
                <div id="passo-2" class="modo-lote-passo">
                    <h3 class="passo-titulo">Selecionar moradores (<span id="contador-moradores">0</span> selecionados)</h3>
                    
                    <div class="form-group">
                        <label for="lote-busca-morador">Buscar Moradores</label>
                        <div class="input-with-icon">
                            <span class="material-symbols-outlined">search</span>
                            <input type="text" id="lote-busca-morador" placeholder="Digite o nome do morador..." autocomplete="off">
                        </div>
                        <div id="lote-morador-suggestions" class="suggestions-list"></div>
                    </div>

                    <div class="moradores-selecionados">
                        <div id="lista-moradores-selecionados" class="moradores-lista"></div>
                    </div>
                </div>

                <!-- Passo 3: Resumo -->
                <div id="passo-3" class="modo-lote-passo">
                    <h3 class="passo-titulo">Resumo do Lote</h3>
                    
                    <div class="resumo-header">
                        <div class="resumo-info">
                            <p><strong>Porteiro:</strong> <span id="resumo-porteiro">-</span></p>
                            <p><strong>Data/Hora:</strong> <span id="resumo-data-hora">-</span></p>
                            <p><strong>Total:</strong> <span id="resumo-total">-</span> encomendas</p>
                        </div>
                    </div>

                    <div class="resumo-moradores">
                        <h4>Encomendas por Morador:</h4>
                        <div id="resumo-lista-moradores" class="resumo-lista"></div>
                    </div>
                </div>
            </div>

            <!-- Footer com Botões -->
            <div class="modo-lote-footer">
                <button type="button" id="btn-proximo-passo" class="btn-primary">
                    <span>Selecionar Moradores</span>
                    <span class="material-symbols-outlined">arrow_forward</span>
                </button>
                <button type="button" id="btn-finalizar-lote" class="btn-success" style="display: none;">
                    <span class="material-symbols-outlined">check_circle</span>
                    <span>Confirmar Lote</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Quantidade -->
    <div id="modal-quantidade" class="modal-overlay">
        <div class="modal-content quantidade-modal">
            <h3>Quantidade de Encomendas</h3>
            <p id="quantidade-morador-info">Selecione um morador</p>
            
            <div class="quantidade-controls">
                <button type="button" id="btn-diminuir-quantidade" class="btn-quantidade">
                    <span class="material-symbols-outlined">remove</span>
                </button>
                <input type="number" id="input-quantidade" value="1" min="1" max="99">
                <button type="button" id="btn-aumentar-quantidade" class="btn-quantidade">
                    <span class="material-symbols-outlined">add</span>
                </button>
            </div>

            <div class="modal-actions">
                <button type="button" id="btn-cancelar-quantidade" class="btn-secondary">Cancelar</button>
                <button type="button" id="btn-confirmar-quantidade" class="btn-primary">Confirmar</button>
            </div>
        </div>
    </div>

    <!-- Carregar apenas o renderer modularizado que gerencia todos os módulos -->
    <script src="renderer-modular.js"></script>
    
    <!-- Script para verificar se tudo carregou corretamente -->
    <script>
        // Verificar se todos os módulos carregaram após 3 segundos
        setTimeout(() => {
            if (window.debugManager) {
                window.debugManager.checkForIssues();
            }
            
            // Verificar se há problemas específicos
            if (!window.authManager) {
                console.error('AuthManager não foi inicializado!');
            }
            
            if (!window.contentManager) {
                console.error('ContentManager não foi inicializado!');
            }
            
            if (!window.formsManager) {
                console.error('FormsManager não foi inicializado!');
            }
        }, 3000);
    </script>
</body>
</html> 